#: import os os

<SongBuilder>:
    TabViewer:
        id: tabviewer
        pos_hint: {'center_x': 0.5}
        size_hint: [1, None]
        height: root.height - editbar.height
        y: editbar.top
    EditToolbar:
        id: editbar
        tabviewer: tabviewer


<TabViewer>:
    bar_width: 10
    scroll_type: ['bars', 'content']


<TabWidget>:
    size_hint: [None, None]
    height: self.step_y * 10
    width: self.timesig_width + self.open_repeat_width + (self.measure_end - self.measure_start) + self.close_repeat_width
    canvas.before:
        # White background.
        Color:
            rgba: (1, 1, 1, 1)
        Rectangle:
            size: (self.width, self.height)
            pos: self.pos
        # Selected overlay.
        Color:
            rgba: (1, 1, 0, self.selected_opac)
        Rectangle:
            size: (self.width, self.height)
            pos: self.pos
        # Add lines.
        Color:
            rgba: (0, 0, 0, 1)
        # Left barline.
        Line:
            points:
                (self.barline_x, self.y + self.step_y * 8,
                self.barline_x, self.y + self.step_y * 3)
        # Staff lines.
        Line:
            points:
                (self.x, self.y + self.step_y * 3,
                self.right, self.y + self.step_y * 3)
        Line:
            points:
                (self.x, self.y + self.step_y* 4,
                self.right, self.y + self.step_y * 4)
        Line:
            points:
                (self.x, self.y + self.step_y * 5,
                self.right, self.y + self.step_y * 5)
        Line:
            points:
                (self.x, self.y + self.step_y * 6,
                self.right, self.y + self.step_y * 6)
        Line:
            points:
                (self.x, self.y + self.step_y * 7,
                self.right, self.y + self.step_y * 7)
        Line:
            points:
                (self.x, self.y + self.step_y * 8,
                self.right, self.y + self.step_y * 8)
        # Measure end line.
        Line:
            points:
                (self.right, self.y + self.step_y * 8,
                self.right, self.y + self.step_y * 3)
        # Open repeat lines.
        Color:
            rgba: (0, 0, 0, self.open_repeat_opac)
        Rectangle:
            pos: (self.barline_x, self.y + self.step_y * 3)
            size: (6, self.step_y * 5)
        Line:
            points:
                (self.barline_x + 12, self.y + self.step_y * 8,
                self.barline_x + 12, self.y + self.step_y * 3)
        Ellipse:
            pos: (self.barline_x + 16, self.y + self.step_y * 4.5 - 3)
            size: (6.5, 6.5)
        Ellipse:
            pos: (self.barline_x + 16, self.y + self.step_y * 6.5 - 3)
            size: (6.5, 6.5)
        # Measure start line.
        Line:
            points:
                (self.measure_start, self.y + self.step_y * 8,
                self.measure_start, self.y + self.step_y * 3)
#        # Close repeat lines.
        Color:
            rgba: (0, 0, 0, self.close_repeat_opac)
        Rectangle:
            pos: (self.right - 6 , self.y + self.step_y * 3)
            size: (6, self.step_y * 5)
        Line:
            points:
                (self.right - 12, self.y + self.step_y * 8,
                self.right - 12, self.y + self.step_y * 3)
        Ellipse:
            pos: (self.right - 22, self.y +  self.step_y * 4.5 - 3)
            size: (6, 6)
        Ellipse:
            pos: (self.right - 22, self.y + self.step_y * 6.5 - 3)
            size: (6, 6)
        # Measure end line.
        Line:
            points:
                (self.measure_end, self.y + self.step_y * 8,
                self.measure_end, self.y + self.step_y * 3)

<EditToolbar>:
    size_hint: [1, None]
    height: copy_btn.height
    EditToolbarButton:
        id: copy_btn
        text: "Copy"
        on_press: root.tabviewer.copy()
    EditToolbarButton:
        id: paste_btn
        text: "Paste"
        x: copy_btn.right
    EditToolbarButton:
        id: delete_btn
        text: "Delete"
        x: paste_btn.right
        on_press: root.tabviewer.delete()
    EditToolbarButton:
        id: rebuild_btn
        text: "Rebuild"
        x: delete_btn.right
        on_press: root.tabviewer.rebuild()
    EditToolbarButton:
        id: load_btn
        text: "Load File"
        x: rebuild_btn.right
        on_press: root.tabviewer.show_fileloader()
<EditToolbarButton@Button>:
    size_hint: [None, None]
    size: [150, 50]


<CopyPopup>:
    size_hint: [None, None]
    size: [200, 60]
    pos_hint: {'center': [0.5, 0.5]}
    separator_color: (0,0,0,0)
    title: 'Measures Copied'
    title_align: 'center'
    font_size: 18

<FileLoaderPopupContent>:
    orientation: "vertical"
    FileChooserListView:
        id: filechooser
        path: os.getcwd()
    BoxLayout:
        size_hint_y: None
        height: 30
        Button:
            text: "Cancel"
            on_release: root.cancel()
        Button:
            text: "Load"
            on_release: root.load_song(filechooser.selection)